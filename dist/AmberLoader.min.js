(function(){const LOG_LEVELS={SILENT:0,ERROR:1,WARN:2,INFO:3};const TESTMODE=true;const POLL_INTERVAL_SECONDS=300;const LOG_LEVEL=LOG_LEVELS.WARN;const NOFOOTER=false;const AUTOCLOSE=true;const HREF=true;const SIZELIST=[[3120,260],[1920,1200],[1920,1080],[1080,1920],[1792,640],[1560,1440],[1440,760],[1320,720],[1312,704],[1200,800],[1152,896],[1152,768],[1150,160],[980,440],[970,250],[936,624],[800,600],[800,130],[768,864],[768,405],[768,384],[728,90],[726,482],[720,540],[720,528],[640,540],[600,500],[588,1008],[576,480],[540,960],[480,270],[432,1008],[360,252],[336,280],[335,224],[300,600]];const BASEURL_PROD="https://www.burgernet.nl/static/posters/landelijk/";const BASEURL_TEST="https://www.burgernet.nl/static/posters/test/";const POLLURL=getSizeUrl(SIZELIST[SIZELIST.length-1]);const VERSION="1.2.1";const COOKIE_PREFIX="AmberLoader-";const COOKIE_POLL_KEY=COOKIE_PREFIX+"lastPoll";const COOKIE_COLLAPSED_KEY=COOKIE_PREFIX+"collapsed";const COOKIE_ACTIVEALERT_KEY=COOKIE_PREFIX+"activealert";const LOG_PREFIX="[AmberLoader]";function logInfo(...args){if(LOG_LEVEL>=LOG_LEVELS.INFO){console.info(LOG_PREFIX,...args)}}function logWarn(...args){if(LOG_LEVEL>=LOG_LEVELS.WARN){console.warn(LOG_PREFIX,...args)}}function logError(...args){if(LOG_LEVEL>=LOG_LEVELS.ERROR){console.error(LOG_PREFIX,...args)}}logInfo("Verbose logging is enabled!");function getBestImage(){const screenW=window.innerWidth;const screenH=window.innerHeight;const screenArea=screenW*screenH;const screenRatio=screenW/screenH;let bestImage=null;let bestScore=Number.POSITIVE_INFINITY;for(let img of SIZELIST){const imgRatio=img[0]/img[1];const ratioDiff=Math.abs(imgRatio-screenRatio);const imgArea=img[0]*img[1];const areaDiff=Math.abs(imgArea-screenArea);const score=ratioDiff*1e3+areaDiff*.001;if(score<bestScore){bestImage=img;bestScore=score}}if(!bestImage){logWarn("No best image was found, falling back to highest resolution with correct aspect ratio...");bestImage=SIZELIST.reduce(((best,current)=>{const currentRatioDiff=Math.abs(current.width/current.height-screenRatio);const bestRatioDiff=Math.abs(best.width/best.height-screenRatio);return currentRatioDiff<bestRatioDiff||currentRatioDiff===bestRatioDiff&&current.width*current.height>best.width*best.height?current:best}))}logInfo(`Found best image size: ${bestImage}`);return bestImage}function getSizeUrl(bestImage){const base=TESTMODE?BASEURL_TEST:BASEURL_PROD;return`${base}${bestImage[0]}x${bestImage[1]}.jpg`}function setCookie(name,value,seconds=3600){const expires=seconds?`; max-age=${seconds}`:"";document.cookie=`${name}=${encodeURIComponent(value)}${expires}; path=/`}function getCookie(name){const match=document.cookie.match(new RegExp("(^| )"+name+"=([^;]+)"));return match?decodeURIComponent(match[2]):null}function secondsSinceLastPoll(){const last=parseInt(getCookie(COOKIE_POLL_KEY)||"0",10);return Math.floor(Date.now()/1e3)-last}function updateLastPollTime(){setCookie(COOKIE_POLL_KEY,Math.floor(Date.now()/1e3).toString())}function activeAlert(){return getCookie(COOKIE_ACTIVEALERT_KEY)=="true"}function moveBodyToY(pixels){const children=Array.from(document.body.children);logInfo(`Moving body and elements to Y ${pixels}...`);children.forEach((child=>{if(child.id.includes("AmberLoader-")){return}if(!child.hasAttribute("data-shifty-original")){const computedTransform=window.getComputedStyle(child).transform;child.setAttribute("data-shifty-original",computedTransform&&computedTransform!=="none"?computedTransform:"")}const originalTransform=child.getAttribute("data-shifty-original");const newTransform=combineTransformWithTranslateY(originalTransform,pixels);child.style.transform=newTransform;logInfo(`Moved ${child}`)}));logInfo(`Body and elements have been moved!`)}function combineTransformWithTranslateY(baseTransform,pixels){let cleaned=baseTransform.replace(/translateY\([^)]+\)/,"").trim();if(pixels!==0){cleaned+=(cleaned?" ":"")+`translateY(${pixels}px)`}return cleaned||"none"}function renderPoster(){if(activeAlert()&&!document.getElementById("AmberLoader-popup")){logInfo("Rendering poster...");const popup=document.createElement("div");popup.id="AmberLoader-popup";popup.classList.add("AmberLoader-popup");popup.ariaLabel="Amber Alert melding";if(getCookie(COOKIE_COLLAPSED_KEY)=="true"){popup.classList.add("AmberLoader-hidden");logInfo("Active alert but popup is collapsed.")}const closeBtn=document.createElement("div");closeBtn.className="AmberLoader-closeBtn";closeBtn.innerHTML="&times;";closeBtn.ariaLabel="Sluit Amber Alert melding";popup.appendChild(closeBtn);const img=document.createElement("img");img.id="AmberLoader-image";img.className="AmberLoader-image";img.onerror=()=>{logWarn("Poster attempted loading but failed, cancelling...");cancelAlert()};img.src=getSizeUrl(getBestImage());img.alt="Amber Alert";if(HREF){const link=document.createElement("a");link.href="https://www.politie.nl/amberalert";link.target="_blank";link.rel="noopener noreferrer";link.className="AmberLoader-imgLink";link.appendChild(img);popup.appendChild(link)}else{popup.appendChild(img)}if(!NOFOOTER){const footer=document.createElement("div");footer.className="AmberLoader-footer";if(TESTMODE)footer.classList.add("AmberLoader-testmode");footer.innerHTML=`AmberLoader V${VERSION} - <a href="https://github.com/jkctech/AmberLoader" target="_blank" rel="noopener noreferrer">Probleem melden</a>`;popup.appendChild(footer)}const banner=document.createElement("div");banner.id="AmberLoader-banner";banner.className="AmberLoader-banner";banner.textContent="Amber Alert actief! (Klik om te openen)";banner.role="dialog";if(TESTMODE)banner.classList.add("AmberLoader-testmode");document.body.prepend(popup);document.body.prepend(banner);popup.querySelector(".AmberLoader-closeBtn").addEventListener("click",(()=>{popup.classList.add("AmberLoader-hidden");document.body.classList.remove("AmberLoader-noscroll");setCookie(COOKIE_COLLAPSED_KEY,true);logInfo("Popup has been collapsed.")}));banner.addEventListener("click",(()=>{popup.classList.remove("AmberLoader-hidden");document.body.classList.add("AmberLoader-noscroll");if(!AUTOCLOSE)setCookie(COOKIE_COLLAPSED_KEY,false);logInfo("Popup has been opened up.")}));moveBodyToY(document.getElementById("AmberLoader-banner").offsetHeight);if(AUTOCLOSE){setCookie(COOKIE_COLLAPSED_KEY,true)}}}function cancelAlert(){if(activeAlert()){logInfo("Cancelling...");setCookie(COOKIE_ACTIVEALERT_KEY,false);setCookie(COOKIE_COLLAPSED_KEY,false);document.getElementById("AmberLoader-popup")?.remove();document.getElementById("AmberLoader-banner")?.remove();moveBodyToY(0);logInfo("Alert has been cancelled.")}}async function UpdatePosters(){const img=new Image;img.style.display="none";img.style.position="absolute";img.style.width="0";img.style.height="0";const cleanup=()=>{img.onload=null;img.onerror=null;if(img.parentNode){img.parentNode.removeChild(img)}logInfo("Temp image deleted.")};img.onload=()=>{cleanup();setCookie(COOKIE_ACTIVEALERT_KEY,true);logInfo("Alert has been detected!");renderPoster()};img.onerror=()=>{cleanup();setCookie(COOKIE_ACTIVEALERT_KEY,false);logInfo("No active alert detected.");cancelAlert()};document.body.appendChild(img);img.src=POLLURL;logInfo("Temp image created.");updateLastPollTime()}function init(){const prepareAlerts=async()=>{if(secondsSinceLastPoll()>=POLL_INTERVAL_SECONDS){logInfo("Polling for new alerts...");await UpdatePosters()}renderPoster()};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",prepareAlerts)}else{prepareAlerts()}window.addEventListener("resize",(()=>{if(activeAlert){logInfo("Resize...");document.getElementById("AmberLoader-image").src=getSizeUrl(getBestImage());moveBodyToY(document.getElementById("AmberLoader-banner").offsetHeight)}}))}init()})();